
<!DOCTYPE html>
<html lang="fr">
<head>
    {% if app.environment == 'prod' %}
        <meta name="robots" content="index, follow">
    {% else %}
        <meta name="robots" content="noindex, nofollow">
    {% endif %}

    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">


    <title>
        {% block title %}
            Écurie Des 4 Routes
        {% endblock %}
    </title>
    {# mettre un block meta description sur toutes les pages du site #}
    <meta name="description" content="{% block meta_description %}Écurie Des 4 Routes - Découvrez notre écurie équestre en Bretagne. Cours d'équitation, pension pour chevaux, stages et balades.{% endblock %}">

    {# Géolocalisation (votre code existant) #}
    <meta name="geo.region" content="FR-35">
    <meta name="geo.place_name" content="Iffendic">
    <meta name="geo.position" content="48.090811;-2.002566">
    <meta name="ICBM" content="48.090811, -2.002566">
    <link rel="icon" type="image/x-icon" href="{{ asset('images/favicon.ico') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ asset('images/apple-touch-icon.png') }}">
    <link rel="icon" type="image/png" sizes="32x32" href="{{ asset('images/favicon-32x32.png') }}">
    <link rel="icon" type="image/png" sizes="16x16" href="{{ asset('images/favicon-16x16.png') }}">


    {% block stylesheets %}
        <link rel="stylesheet" href="{{ asset('styles/app.css') }}">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css"
              integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
        <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css">
    {% endblock %}

    {# Bloc pour les scripts JavaScript. #}
    {% block javascripts %}

        {% block importmap %}
            {{ importmap('app') }}
        {% endblock %}

        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
                integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
                crossorigin="anonymous"></script>
    {% endblock %}
</head>

<body class="d-flex flex-column">
<header>
    <div class="container">
        {% include '_navbar.html.twig' %}
    </div>
</header>

<main class="flex-grow-1">

    {% for message in app.flashes('warning') %}
        <div class="alert alert-warning">
            {{ message }}
        </div>
    {% endfor %}

    {% for message in app.flashes('danger') %}
        <div class="alert alert-danger">
            {{ message }}
        </div>
    {% endfor %}

    {% for message in app.flashes('success') %}
        <div class="alert alert-success">
            {{ message }}
        </div>
    {% endfor %}
    <div class="container">
        {% block body %}{% endblock %}
    </div>
</main>

<footer>
    <div class="bg-dark text-white py-2" data-turbo="false">
        <div class="container">
            <div class="d-flex justify-content-between">
                <a href="https://www.google.fr/maps/search/?api=1&query=Ecuries+des+quatre+routes+35750+IFFENDIC"
                   target="_blank"
                   class="text-white text-decoration-none d-flex align-items-center" title="map-ecuriesdes4routes">
                    <i class="bi bi-geo-alt-fill me-2"></i> &copy; {{ "now"|date("Y") }} - Écuries Des 4 Routes - 217 Les Quatre Routes, 35750 Iffendic
                </a>
                <a id="phone-link" class="text-white text-decoration-none d-flex align-items-center cursor-pointer">
                    <i class="bi bi-telephone-fill me-2"></i> <span id="phone-display">Afficher le numéro</span>
                </a>
                <a href="javascript:void(0)"
                   onclick="fetch('/log-honeypot-click'); return false;"
                   class="honeypot"
                   aria-hidden="true">09 99 99 99 99
                </a>
            </div>
        </div>
    </div>

</footer>

{% block extraJs %}
    <script>
        // Fonction principale de configuration du téléphone
        function setupPhoneDisplay() {

            const phoneLink = document.getElementById('phone-link');
            const phoneDisplay = document.getElementById('phone-display');

            if (!phoneLink || !phoneDisplay) return;

            // Numéro divisé en parties pour éviter le scraping simple
            const parts = ['06', '98', '73', '76', '00'];
            const fullNumber = parts.join('');
            const formattedNumber = parts.join(' ');

            // Vérifier si le numéro a déjà été révélé
            const phoneRevealed = document.cookie.includes('phoneRevealed=true');

            if (phoneRevealed) {
                // Si déjà révélé, afficher immédiatement
                phoneLink.href = 'tel:' + fullNumber;
                phoneDisplay.textContent = formattedNumber;
            } else {
                // Sinon, attendre le clic
                // Nettoyer les écouteurs existants pour éviter les doublons
                const newPhoneLink = phoneLink.cloneNode(true);
                phoneLink.parentNode.replaceChild(newPhoneLink, phoneLink);

                newPhoneLink.addEventListener('click', function(e) {
                    e.preventDefault();

                    // Mettre à jour le lien et le texte
                    this.href = 'tel:' + fullNumber;
                    document.getElementById('phone-display').textContent = formattedNumber;

                    // Créer un cookie de session (expire à la fermeture du navigateur)
                    document.cookie = 'phoneRevealed=true; path=/';
                });
            }
        }

        // Chargement initial
        document.addEventListener('DOMContentLoaded', setupPhoneDisplay);

        // Événements Turbo - pour les navigations via Turbo
        document.addEventListener('turbo:load', setupPhoneDisplay);
        document.addEventListener('turbo:render', setupPhoneDisplay);

        // Pour les navigations Turbo Frame
        document.addEventListener('turbo:frame-load', setupPhoneDisplay);

        // Exécuter immédiatement en cas de chargement tardif
        if (document.readyState === 'complete' || document.readyState === 'interactive') {
            setTimeout(setupPhoneDisplay, 100);
        }
    </script>
{% endblock %}
</body>
</html>