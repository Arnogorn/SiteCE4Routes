<nav class="navbar navbar-expand-lg navbar-modern sticky-top">
    <div class="container-fluid px-2">
        {# Niveau supérieur - Logo et titre centré #}
        <div class="navbar-top-level d-flex justify-content-between align-items-center w-100">
            <a class="navbar-brand" href="{{ path('index') }}" title="Écuries des 4 Routes - Équitation en Bretagne">
                <img src="{{ asset('images/logo.png') }}"
                     alt="Logo Écuries des 4 Routes" class="logo-modern">
            </a>
            <div class="text-center">
                <span class="brand-text">Écuries des 4 Routes</span>
                <div style="font-size: 0.65rem; color: var(--text-secondary); font-style: italic; letter-spacing: 0.3px;">
                    ÉQUITATION • PASSION
                </div>
            </div>
            <a class="navbar-brand" href="https://www.ffe.com/pratiquer/labels/mention-bien-etre-animal" title="Écuries des 4 Routes - Équitation en Bretagne" target="_blank" rel="noopener noreferrer">
                <img src="{{ asset('images/label_ffe.png') }}"
                     alt="Logo Écuries des 4 Routes" class="logo-modern">
            </a>
        </div>

        {# Niveau inférieur - Navigation et actions #}
        <div class="navbar-bottom-level">
            {# Section mobile - Bouton toggle à gauche #}
            <div class="d-flex align-items-center d-lg-none">
                {% if app.user %}
                    <div class="user-info-mobile me-2">
                        <i class="bi bi-person-circle" style="font-size: 1.1rem;"></i>
                    </div>
                {% endif %}
                <button class="navbar-toggler border-0" type="button" data-bs-toggle="collapse"
                        data-bs-target="#navbarContent" aria-controls="navbarContent"
                        aria-expanded="false" aria-label="Toggle navigation">
                    <span class="navbar-toggler-icon"></span>
                </button>
            </div>

            {# Contenu principal - Navigation #}
            <div class="collapse navbar-collapse" id="navbarContent">
                {# Menu principal - Centré #}
                <ul class="navbar-nav mb-2 mb-lg-0">
                    <li class="nav-item">
                        <a class="nav-link nav-link-modern {{ app.request.get('_route') == 'index' ? 'active' : '' }}"
                           href="{{ path('index') }}" title="Accueil">
                            <i class="bi bi-house-heart"></i>
                            <span class="ms-1">Accueil</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-link-modern {{ 'sortie' in app.request.get('_route') ? 'active' : '' }}"
                           href="{{ path('app_sortie_index') }}" title="Sorties">
                            <i class="bi bi-compass"></i>
                            <span class="ms-1">Activités</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-link-modern {{ 'calendrier' in app.request.get('_route') ? 'active' : '' }}"
                           href="{{ path('app_calendrier_index') }}" title="Calendrier">
                            <i class="bi bi-calendar-event"></i>
                            <span class="ms-1">Calendrier</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-link-modern {{ 'ecurie_proprietaire' in app.request.get('_route') ? 'active' : '' }}"
                           href="{{ path('app_ecurie_proprietaire_index') }}" title="Écurie">
                            <i class="bi bi-building"></i>
                            <span class="ms-1">Écurie</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-link-modern {{ 'commerce' in app.request.get('_route') ? 'active' : '' }}"
                           href="{{ path('commerce') }}" title="Commerce">
                            <i class="bi bi-shop"></i>
                            <span class="ms-1">Commerce</span>
                        </a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link nav-link-modern {{ 'tarifs' in app.request.get('_route') ? 'active' : '' }}"
                           href="{{ path('app_tarifs_index') }}" title="Poney club">
                            <i class="bi bi-heart-fill"></i>
                            <span class="ms-1">Poney club</span>
                        </a>
                    </li>

                    {# Menu dropdown #}
                    <li class="nav-item dropdown">
                        <a class="nav-link nav-link-modern dropdown-toggle" id="navbarDropdown"
                           role="button" data-bs-toggle="dropdown" aria-expanded="false">
                            <i class="bi bi-grid-3x3-gap"></i>
                            <span class="ms-1">Plus</span>
                        </a>
                        <ul class="dropdown-menu dropdown-menu-modern" aria-labelledby="navbarDropdown">
                            <li>
                                <h6 class="dropdown-header text-primary-brand">
                                    <i class="bi bi-heart-fill me-2"></i>Nos Animaux
                                </h6>
                            </li>
                            <li>
                                <a class="dropdown-item {{ 'cheval' in app.request.get('_route') ? 'active' : '' }}"
                                   href="{{ path('app_cheval_index') }}">
                                    <i class="bi bi-heart me-2"></i>Nos Chevaux
                                </a>
                            </li>
                            <li>
                                <h6 class="dropdown-header text-primary-brand">
                                    <i class="bi bi-trophy me-2"></i>Compétitions
                                </h6>
                            </li>
                            <li>
                                <a class="dropdown-item {{ 'competition' in app.request.get('_route') ? 'active' : '' }}"
                                   href="{{ path('app_competition_index') }}">
                                    <i class="bi bi-trophy me-2"></i>Compétitions
                                </a>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <h6 class="dropdown-header text-primary-brand">
                                    <i class="bi bi-info-circle me-2"></i>Informations
                                </h6>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{{ path('app_contact_index') }}">
                                    <i class="bi bi-envelope me-2"></i>Notre équipe
                                </a>
                            </li>
                            <li>
                                <a class="dropdown-item" href="{{ path('anniversaire') }}">
                                    <i class="bi bi-balloon me-2"></i>Anniversaire
                                </a>
                            </li>

                        </ul>
                    </li>
                </ul>
            </div>

            {# Section utilisateur - À droite #}
            <div class="navbar-user-section d-none d-lg-flex">
                {% if app.user %}
                    {# Info utilisateur #}
                    <div class="user-welcome d-none d-xl-flex align-items-center me-2">
                        <small class="text-muted me-1" style="font-size: 0.7rem;">Bonjour</small>
                        <span class="fw-bold text-primary-brand" style="font-size: 0.85rem;">{{ app.user.prenom }}</span>
                        <i class="bi bi-person-badge ms-1" style="color: var(--accent-color); font-size: 1rem;"></i>
                    </div>

                    {# Menu utilisateur #}
                    <div class="dropdown">
                        <button class="btn btn-user-modern dropdown-toggle" type="button"
                                id="userDropdown" data-bs-toggle="dropdown" aria-expanded="false"
                                aria-label="Menu utilisateur">
                            <i class="bi bi-person-gear me-1"></i>
                            <span class="d-none d-lg-inline">Menu</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-end dropdown-menu-modern"
                            aria-labelledby="userDropdown">
                            <li class="dropdown-header" style="background: var(--bg-tertiary); border-radius: 8px;">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-person-circle fs-5 me-2 text-primary-brand"></i>
                                    <div>
                                        <div class="fw-bold text-primary-brand" style="font-size: 0.9rem;">{{ app.user.prenom }} {{ app.user.nom }}</div>
                                        <small class="text-muted" style="font-size: 0.75rem;">{{ app.user.email }}</small>
                                    </div>
                                </div>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item" href="{{ path('app_user_show', {'id': app.user.id}) }}">
                                    <i class="bi bi-person me-2"></i>Mon Profil
                                </a>
                            </li>
                            {% if 'ROLE_ADMIN' in app.user.roles %}
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <h6 class="dropdown-header text-primary-brand">
                                        <i class="bi bi-shield-lock me-2"></i>Administration
                                    </h6>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{{ path('app_admin_index') }}">
                                        <i class="bi bi-speedometer2 me-2"></i>Tableau de bord
                                    </a>
                                </li>
                            {% endif %}
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item text-danger" href="{{ path('app_logout') }}">
                                    <i class="bi bi-box-arrow-right me-2"></i>Déconnexion
                                </a>
                            </li>
                        </ul>
                    </div>
                {% else %}
                    {# Boutons connexion/inscription #}
                    <div class="d-flex gap-1 align-items-center">
                        <a href="{{ path('app_login') }}" class="btn btn-outline-modern" title="Connexion">
                            <i class="bi bi-box-arrow-in-right me-1"></i>
                            <span>Connexion</span>
                        </a>
                        <a href="{{ path('app_register') }}" class="btn btn-modern-primary" title="S'inscrire">
                            <i class="bi bi-person-plus me-1"></i>
                            <span>S'inscrire</span>
                        </a>
                    </div>
                {% endif %}
            </div>

            {# Section utilisateur mobile - En bas sur mobile #}
            <div class="navbar-user-section d-lg-none w-100">
                {% if app.user %}
                    <div class="dropdown w-100">
                        <button class="btn btn-user-modern dropdown-toggle w-100" type="button"
                                id="userDropdownMobile" data-bs-toggle="dropdown" aria-expanded="false"
                                aria-label="Menu utilisateur">
                            <i class="bi bi-person-gear me-1"></i>
                            <span>Menu {{ app.user.prenom }}</span>
                        </button>
                        <ul class="dropdown-menu dropdown-menu-modern w-100"
                            aria-labelledby="userDropdownMobile">
                            <li class="dropdown-header" style="background: var(--bg-tertiary); border-radius: 8px;">
                                <div class="d-flex align-items-center">
                                    <i class="bi bi-person-circle fs-5 me-2 text-primary-brand"></i>
                                    <div>
                                        <div class="fw-bold text-primary-brand" style="font-size: 0.9rem;">{{ app.user.prenom }} {{ app.user.nom }}</div>
                                        <small class="text-muted" style="font-size: 0.75rem;">{{ app.user.email }}</small>
                                    </div>
                                </div>
                            </li>
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item" href="{{ path('app_user_show', {'id': app.user.id}) }}">
                                    <i class="bi bi-person me-2"></i>Mon Profil
                                </a>
                            </li>
                            {% if 'ROLE_ADMIN' in app.user.roles %}
                                <li><hr class="dropdown-divider"></li>
                                <li>
                                    <h6 class="dropdown-header text-primary-brand">
                                        <i class="bi bi-shield-lock me-2"></i>Administration
                                    </h6>
                                </li>
                                <li>
                                    <a class="dropdown-item" href="{{ path('app_admin_index') }}">
                                        <i class="bi bi-speedometer2 me-2"></i>Tableau de bord
                                    </a>
                                </li>
                            {% endif %}
                            <li><hr class="dropdown-divider"></li>
                            <li>
                                <a class="dropdown-item text-danger" href="{{ path('app_logout') }}">
                                    <i class="bi bi-box-arrow-right me-2"></i>Déconnexion
                                </a>
                            </li>
                        </ul>
                    </div>
                {% else %}
                    {# Boutons connexion/inscription mobile #}
                    <div class="d-flex gap-2 w-100">
                        <a href="{{ path('app_login') }}" class="btn btn-outline-modern flex-fill" title="Connexion">
                            <i class="bi bi-box-arrow-in-right me-1"></i>
                            <span>Connexion</span>
                        </a>
                        <a href="{{ path('app_register') }}" class="btn btn-modern-primary flex-fill" title="S'inscrire">
                            <i class="bi bi-person-plus me-1"></i>
                            <span>S'inscrire</span>
                        </a>
                    </div>
                {% endif %}
            </div>
        </div>
    </div>
</nav>

{# Barre d'info secondaire #}
{% if app.user %}
    <div class="info-bar-modern d-none d-md-block">
        <div class="container-fluid px-2">
            <div class="d-flex justify-content-between align-items-center">
                <div class="d-flex align-items-center">
                    <small class="text-muted me-3" style="font-size: 0.75rem;">
                        <i class="bi bi-calendar3 me-1 text-accent-brand"></i>
                        {{ "now"|format_date('medium', locale='fr') }}
                    </small>
                    <small class="text-muted" style="font-size: 0.75rem;">
                        <i class="bi bi-clock me-1 text-accent-brand"></i>
                        <span id="current-time">{{ "now"|date('H:i') }}</span>
                    </small>
                </div>
            </div>
        </div>
    </div>
{% endif %}