<div class="container-fluid">
    <!-- Informations utilisateur -->
    <div class="card border-primary mb-3">
        <div class="card-header bg-primary text-white">
            <h6 class="mb-0">üë§ {{ user.prenom }} {{ user.nom }} (ID: {{ user.id }})</h6>
        </div>
        <div class="card-body">
            <div class="row">
                <div class="col-md-8">
                    <p><strong>Email :</strong> {{ user.email }}</p>
                    <p><strong>T√©l√©phone :</strong> {{ user.telephone }}</p>
                    {% if user.famille and user.famille.membre|length > 0 %}
                        <p><strong>Famille :</strong> {{ user.famille.membre|length }} membre(s)</p>
                        <ul class="list-unstyled ms-3">
                            {% for membre in user.famille.membre %}
                                <li><small>‚Ä¢ {{ membre.prenom }} {{ membre.nom }}</small></li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                    {% if user.sorties is defined and user.sorties|length > 0 %}
                        <p><strong>Sorties :</strong> {{ user.sorties|length }} participation(s)</p>
                    {% endif %}
                </div>
                <div class="col-md-4">
                    <div class="alert alert-info py-2">
                        <small>
                            <strong>Suppression compl√®te :</strong><br>
                            ‚Ä¢ Utilisateur<br>
                            ‚Ä¢ Famille et membres<br>
                            ‚Ä¢ Inscriptions sorties<br>
                            ‚Ä¢ Tous les paiements<br>
                            ‚Ä¢ Historique
                        </small>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Actions -->
    <div class="card border-warning mb-3">
        <div class="card-header bg-warning text-dark">
            <h6 class="mb-0">‚ö° Actions</h6>
        </div>
        <div class="card-body">
            <div class="row">
                <!-- Analyse -->
                <div class="col-md-6">
                    <h6>1. V√©rifier les paiements</h6>
                    <p><small>Analyser les paiements confirm√©s avant suppression</small></p>
                    <a href="{{ path('admin_user_analyze_payments', {'id': user.id}) }}"
                       class="btn btn-info btn-sm">
                        üí≥ Analyser les paiements
                    </a>
                </div>

                <!-- Suppression -->
                <div class="col-md-6">
                    <h6>2. Supprimer compl√®tement</h6>
                    <p><small>Supprime tout : utilisateur, famille, paiements</small></p>

                    <!-- Formulaire de suppression -->
                    <form method="post" action="{{ path('admin_user_delete_complete', {'id': user.id}) }}"
                          onsubmit="return confirmDeletion()">
                        <input type="hidden" name="_token" value="{{ csrf_token('delete_user_' ~ user.id) }}">
                        <button type="submit" class="btn btn-danger btn-sm">
                            üóëÔ∏è Supprimer d√©finitivement
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <!-- Avertissements -->
    <div class="alert alert-warning">
        <strong>‚ö†Ô∏è Important :</strong>
        <ul class="mb-0">
            <li>La suppression est <strong>irr√©versible</strong></li>
            <li>Tous les paiements seront supprim√©s (m√™me ceux confirm√©s)</li>
            <li>Les remboursements doivent √™tre trait√©s <strong>manuellement dans Stripe</strong></li>
            <li>Toute la famille sera supprim√©e</li>
            <li>Analysez d'abord les paiements pour conna√Ætre les montants √† rembourser</li>
        </ul>
    </div>
</div>

<script>
    function confirmDeletion() {
        const userName = '{{ user.prenom }} {{ user.nom }}';
        const familyCount = {{ user.famille ? user.famille.membre|length : 0 }};

        let message = `Supprimer d√©finitivement ${userName} ?\n\n`;
        message += `Ceci supprimera :\n`;
        message += `‚Ä¢ L'utilisateur\n`;
        if (familyCount > 0) {
            message += `‚Ä¢ Sa famille (${familyCount} membre(s))\n`;
        }
        message += `‚Ä¢ Toutes ses inscriptions aux sorties\n`;
        message += `‚Ä¢ TOUS ses paiements (m√™me confirm√©s)\n`;
        message += `‚Ä¢ Son historique\n\n`;
        message += `‚ö†Ô∏è ATTENTION : Les remboursements devront √™tre trait√©s manuellement dans Stripe !\n\n`;
        message += `Cette action est IRR√âVERSIBLE.\n\n`;
        message += `Continuer ?`;

        return confirm(message);
    }
</script>